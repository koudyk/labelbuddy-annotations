{"text": "Wu, Jianxiao and Ngo, Gia H. and Greve, Douglas and Li, Jingwei and He, Tong and Fischl, Bruce and Eickhoff, Simon B. and Yeo, B.T. Thomas\nHum Brain Mapp, 2018\n\n# Title\n\nAccurate nonlinear mapping between MNI volumetric and FreeSurfer surface coordinate systems\n\n# Keywords\n\natlas\nColin27\ndeformation\nfMRI\ngroup analysis\nMNI152\nregistration\nstructural MRI\nTalairach\n\n\n# Abstract\n \nThe results of most neuroimaging studies are reported in volumetric (e.g., MNI152) or surface (e.g., fsaverage) coordinate systems. Accurate mappings between volumetric and surface coordinate systems can facilitate many applications, such as projecting fMRI group analyses from MNI152/Colin27 to fsaverage for visualization or projecting resting\u2010state fMRI parcellations from fsaverage to MNI152/Colin27 for volumetric analysis of new data. However, there has been surprisingly little research on this topic. Here, we evaluated three approaches for mapping data between MNI152/Colin27 and fsaverage coordinate systems by simulating the above applications: projection of group\u2010average data from MNI152/Colin27 to fsaverage and projection of fsaverage parcellations to MNI152/Colin27. Two of the approaches are currently widely used. A third approach (registration fusion) was previously proposed, but not widely adopted. Two implementations of the registration fusion (RF) approach were considered, with one implementation utilizing the Advanced Normalization Tools (ANTs). We found that RF\u2010ANTs performed the best for mapping between fsaverage and MNI152/Colin27, even for new subjects registered to MNI152/Colin27 using a different software tool (FSL FNIRT). This suggests that RF\u2010ANTs would be useful even for researchers not using ANTs. Finally, it is worth emphasizing that the most optimal approach for mapping data to a coordinate system (e.g., fsaverage) is to register individual subjects directly to the coordinate system, rather than via another coordinate system. Only in scenarios where the optimal approach is not possible (e.g., mapping previously published results from MNI152 to fsaverage), should the approaches evaluated in this manuscript be considered. In these scenarios, we recommend RF\u2010ANTs ( ). \n \n\n# Body\n \n## INTRODUCTION \n  \nMost neuroimaging studies register their participants to a common coordinate system for group analyses (Evans et al.,  ; Fischl, Sereno, Tootell, & Dale,  ; Talairach et al.,  ; Talairach & Tournoux,  ; Thompson et al.,  ; Van Essen,  ). Even studies focusing on individual\u2010specific analyses map individual participants to a common coordinate system (e.g., Gordon et al.,  ), allowing for comparisons across participants or studies. There are two main types of coordinate systems: volumetric and surface. The advantage of volumetric coordinate systems is that both cortical and subcortical structures are represented, in contrast to surface coordinate systems that only focus on the cerebral cortex. Conversely, surface\u2010based coordinate systems allow for more accurate intersubject registration by respecting the 2D topology of the cerebral cortex (Anticevic et al.,  ; Cointepas, Geffroy, Souedet, Denghien, & Riviere,  ; Fischl, Sereno, & Dale,  ; Ghosh et al.,  ; Goebel, Esposito, & Formisano,  ; Pantazis et al.,  ; Tucholka, Fritsch, Poline, & Thirion,  ; Van Essen, Glasser, Dierker, Harwell, & Coalson,  ). \n\nThe most popular volumetric coordinate system is the MNI152 template, obtained by group\u2010wise registration of 152 participants (Fonov et al.,  ; Good et al.,  ; Grabner et al.,  ; Mazziotta, Toga, Evans, Fox, & Lancaster,  , 2001). Another common volumetric coordinate system is the single\u2010subject MNI template (i.e., Colin27; Holmes et al.,  ), often used in the neuroimaging software packages SPM and MRIcron for lesion\u2010symptom mapping (Ashburner & Friston,  ; Rorden, Karnath, & Bonilha,  ). The most popular surface coordinate system is FreeSurfer fsaverage template (Bar & Aminoff,  ; Filimon, Nelson, Hagler, & Sereno,  ; Fischl et al.,  ; Yeo et al.,  ). An important issue with multiple coordinate systems is that results reported in one coordinate system cannot be easily translated to another coordinate system. \n\nWhile there have been tremendous research efforts on mapping data from individual subjects into common coordinate systems (Andersson, Jenkinson, & Smith,  ; Ashburner,  ; Collins, Neelin, Peters, & Evans,  ; Hamm, Ye, Verma, & Davatzikos,  ; Hellier et al.,  ; Nenning et al.,  ; Robinson et al.,  ; Rueckert et al.,  ; Tong, Aganj, Ge, Polimeni, & Fischl,  ; Woods, Grafton, Watson, Sicotte, & Mazziotta,  ; Yeo et al.,  ; Yushkevich, Wang, Pluta, & Avants,  ), there is significantly less work on mappings between coordinate systems (Laird et al.,  ; Lancaster et al.,  ). Accurate mapping between volumetric (e.g., MNI152) and surface (e.g. fsaverage) coordinate systems would be useful for many applications. For example, it is a common practice for researchers to perform group analysis in MNI152 space, and then project the results to fsaverage space for visualization (Liu, Stufflebeam, Sepulcre, Hedden, & Buckner,  ; Sepulcre et al.,  ; Yeo et al.,  ). As another example, resting\u2010state parcellations estimated in fsaverage or fs_LR surface coordinate systems (Glasser et al.,  ; Gordon et al.,  ; Schaefer et al.,  ; Yeo et al.,  ) can be projected to the MNI152 coordinate system for analyzing fMRI data of new subjects registered to the MNI152 template. Finally, a more accurate MNI152\u2010fsaverage mapping would facilitate the comparison of thousands of neuroimaging studies reported in either MNI152 or fsaverage coordinate system. \n\nIn this work, we evaluate three approaches (including two implementations of one of the approaches) for mapping between volumetric (MNI152 or Colin27) and surface (fsaverage) coordinate systems. The evaluation utilized simulations mimicking the previously described applications: projection of group\u2010average data from MNI152/Colin27 to fsaverage and projection of surface\u2010based parcellations from fsaverage to MNI152/Colin27. We note that the evaluations are not comparisons of volumetric and surface registrations. Instead, the evaluations served to provide error bounds on different mappings between MNI152/Colin27 and fsaverage coordinate systems and to guide the adoption of best practices. \n\nIt is also worth emphasizing that a perfect mapping between volumetric and surface coordinate systems is impossible because of registration errors that become irreversible after group averaging. Therefore, the best way of mapping data to fsaverage is by registering subjects directly to fsaverage (e.g., via the official FreeSurfer recon\u2010all pipeline). Similarly, the best way of mapping data to MNI152/Colin27 is by registering subjects directly to the corresponding volumetric template. The approaches evaluated in this article should only be considered when the best approach is not possible, for example, mapping previously published results from MNI152 to fsaverage. Whenever the original data from a subject's native space are available, one should perform registration between the subject's native space and the desired coordinate system (fsaverage, MNI152 or Colin27) directly, rather than utilize the approaches evaluated in this article. \n\n\n## METHODS \n  \n### Volumetric and surface templates \n  \nThe MNI152 coordinate system is created by averaging the MRI scans of 152 participants and affords a higher resolution over the original MNI305 average brain. Here we consider the 1\u00a0mm asymmetric MNI152 template distributed by the FMRIB Software Library (FSL) version 5.0.8. The template was obtained by the linear and nonlinear registration of 152 T1\u2010weighted images (Grabner et al.,  ). \n\nAlthough MNI152 is the most commonly used volumetric coordinate system, the intersubject averaging results in the loss of fine anatomical details. Therefore, some research communities (e.g., neuropsychology) prefer single\u2010subject templates. A commonly used single\u2010subject template is Colin27 (also called the MNI single subject template), which is an average image across 27 scans of one subject (Holmes et al.,  ). We used the 1\u00a0mm Colin27 template from the Statistical Parametric Mappings (SPM) Anatomy Toolbox version 2.2c (Eickhoff et al.,  ). \n\nFinally, the most common surface coordinate system is FreeSurfer fsaverage, which is obtained by spherical alignment of 40 participants (Fischl et al.,  ,  ). As a surface template, fsaverage offers excellent representation of the cortical surface's intrinsic topological structure as well as multi\u2010scale summary statistics of cortical geometry. It also has an inflated form, which facilitates data visualization. We used the fsaverage template from FreeSurfer version 4.5.0. \n\n\n### Data and FreeSurfer processing \n  \nData from 1,490 subjects from the Brain Genomics Superstruct Project (GSP) were considered (Holmes et al.,  ). All imaging data were collected on matched 3T Tim Trio scanners using the vendor\u2010supplied 12\u2010channel phase\u2010array head coil. Subjects were clinically normal, English\u2010speaking young adults (ages 18\u201335). The structural MRI data consisted of one 1.2\u00a0mm \u00d7 1.2\u00a0mm \u00d7 1.2\u00a0mm scan for each participant. Details of data collection can be found elsewhere (Holmes et al.,  ; Yeo et al.,  ). The subjects were split into training and test set, each containing 745 subjects. \n\nA second dataset consisted of 30 healthy young adults from the Hangzhou Normal University of the Consortium for Reliability and Reproducibility (CoRR\u2010HNU) dataset (Chen et al.,  ; Zuo et al.,  ). All anatomical images were collected on matched 3T GE Discovery MR750 scanners using an 8\u2010channel head coil. Ten 1.0\u00a0mm \u00d7 1.0\u00a0mm \u00d7 1.0\u00a0mm scans were performed for each subject across one month. In this article, we utilized all 10 sessions for all 30 subjects, giving rise to a total of 300 sessions. \n\nThe T1 images of the GSP dataset has been previously processed (Holmes et al.,  ) using FreeSurfer 4.5.0 recon\u2010all procedure ( ; Dale, Fischl, & Sereno,  ; Fischl et al.,  ,  ,  ; S\u00e9gonne et al., 2004, 2007). For consistency, the T1 images of the CoRR\u2010HNU dataset were also processed using the same FreeSurfer version. FreeSurfer constitutes a suite of automatic algorithms that extract models of most macroscopic human brain structures from T1 MRI data. There are three outputs of the recon\u2010all procedure that were important for subsequent analyses. \n\nFirst, FreeSurfer automatically reconstructs surface mesh representations of the cortex from individual subjects\u2019 T1 images. The cortical surface mesh is inflated into a sphere, and registered to a common spherical coordinate system that aligned the cortical folding patterns across subjects (Fischl et al.,  ,  ). The outcome of this procedure is a nonlinear mapping between the subject's native T1 space and fsaverage surface space. \n\nSecond, the recon\u2010all procedure generates corresponding volumetric (aparc.a2009s\u2009+\u2009aseg.mgz) and surface (lh.aparc.a2009s.annot and rh.aparc.a2009s.annot) parcellations of 74 sulci and gyri for each subject (Desikan et al.,  ; Destrieux, Fischl, Dale, & Halgren,  ; Fischl et al.,  ). FreeSurfer assign these labels based on probabilistic information estimated from a manually labeled training set (Destrieux atlas) and geometric information derived from the cortical model of the subject. These anatomical segmentations will be utilized in our evaluation of various algorithms for mapping between MNI152/Colin27 and fsaverage. \n\nThird, the recon\u2010all procedure performs a joint registration\u2010segmentation procedure that aligns the T1 image to an internal FreeSurfer volumetric space,  while classifying each native brain voxel into one of multiple brain structures, such as the thalamus and caudate (Fischl et al.,  ,  ). The outcome of this procedure is a nonlinear mapping between the subject's native T1 space and FreeSurfer internal volumetric space. The nonlinear mapping is represented by a dense displacement field (i.e., a single displacement vector at each 2\u00a0mm isotropic atlas voxel) and can be found in the file \u201ctalairach.m3z\u201d (under the \u201cmri/transforms\u201d folder of the recon\u2010all output). \n\n\n### Affine and MNIsurf \n  \nTwo existing approaches (Affine and MNIsurf) for mapping between MNI152 and fsaverage coordinate systems were identified. Both approaches have been discussed on the FreeSurfer mailing list and might be considered as \u201crecommended\u201d FreeSurfer approaches. \n\nFigure   summarizes the Affine approach for mapping between MNI152 and fsaverage surface coordinate systems. The Affine approach made use of an affine transformation between the MNI152 template and fsaverage volume space (Figure  a) provided by FreeSurfer (i.e., $FREESURFER_HOME/average/mni152.register.dat). This affine transformation can be concatenated with the mapping between fsaverage volume and fsaverage surface (Figure  b) using FreeSurfer functions (mri_vol2surf and mri_surf2vol), thus yielding a mapping between MNI152 and fsaverage coordinate systems. \n  \nAffine procedure. (a) MNI152 and fsaverage volume was aligned using an affine transformation. (b) FreeSurfer provides a mapping between fsaverage volume and fsaverage surface. Concatenating the two transformations result in a mapping between MNI152 and fsaverage surface \n  \nOne drawback of this approach is that an affine transformation is unlikely to eliminate nonlinear anatomical differences between MNI152 and fsaverage volume. Simply replacing the affine transformation with a nonlinear warp (Van Essen et al.,  ) might not be helpful because the fsaverage volume is a blurry average of 40 subjects after affine registration; fine anatomical details have already been lost. \n\nFigure   summarizes the MNIsurf approach for mapping between MNI152 and fsaverage surface coordinate systems. The MNI152 template was first processed with FreeSurfer recon\u2010all. The recon\u2010all process involved extracting MNI152 template's cortical ribbon and reconstructing the cortical surface (Figure  a). FreeSurfer commands (mri_vol2surf and mri_surf2vol) could then be utilized to map between MNI152's cortical ribbon (as segmented by recon\u2010all) and fsaverage surface (Figure  b). \n  \nMNIsurf procedure. The MNI152 template was processed using FreeSurfer recon\u2010all. The cortical ribbon of MNI152 was (a) extracted and (b) aligned to fsaverage surface during the recon\u2010all procedure [Color figure can be viewed at  ] \n  \nOne drawback of MNIsurf is that the cortical ribbon of a typical subject mapped to MNI152 coordinate system will not exactly match the group\u2010average MNI152 cortical ribbon (which is abnormally thin and misses some low\u2010frequency and/or thin folds due to intersubject averaging). Consequently, there will be irreversible registration errors from averaging subjects mapped to the MNI152 coordinate system. MNIsurf does not take into account these irreversible registration errors because it simply maps the cortical ribbon of MNI152 directly to fsaverage surface. \n\n\n### Registration fusion: RF\u2010M3Z and RF\u2010ANTs \n  \nThe registration fusion (RF) approach was first introduced by Buckner and colleagues (Buckner, Krienen, Castellanos, Diaz, & Yeo,  ; Yeo et al.,  ). Figure   summarizes the original implementation. Recall that by applying FreeSurfer recon\u2010all procedure to each GSP training subject, we have generated for each subject a nonlinear mapping between the subject's cortical ribbon and fsaverage surface space (Figure  c) and a nonlinear mapping between the subject's T1 volume and FreeSurfer internal volumetric space (Figure  b). By also processing the MNI152 template with FreeSurfer recon\u2010all, we also obtained a nonlinear mapping between the MNI152 template and FreeSurfer internal volumetric space (Figure  a). By concatenating the three transformations (Figure  a\u2013c) for each subject, a mapping between MNI152 and fsaverage coordinate systems for each GSP training subject was obtained. By averaging across all 745 training subjects, a final mapping between MNI152 and fsaverage coordinate systems was obtained. This mapping is referred to as RF\u2010M3Z. \n  \nRegistration fusion (RF\u2010M3Z) procedure. Each subject's T1 volume is mapped to the (a, b) MNI152 template and (c) fsaverage surface. By concatenating the mappings for each subject and then averaging the deformations across all 745 training subjects, we created a mapping between MNI152 and fsaverage surface space. All mappings (a\u2013c) were generated using FreeSurfer's recon\u2010all procedure. More specifically, mappings (a) and (b) were provided by the talairach.m3z files generated by recon\u2010all, so we refer to the resulting MNI152\u2010fsaverage mapping as RF\u2010M3Z [Color figure can be viewed at  ] \n  \nVisual inspection suggested that the mappings between MNI152 and individual subjects (concatenations of transformations in Figure  a,b) were of good quality (Buckner et al.,  ; Yeo et al.,  ). However, by concatenating two deformations, small registration errors in each deformation may be compounded to result in large registration errors. Furthermore, FreeSurfer is optimized for processing the brains of individual subjects, not an average brain like the MNI152 template. \n\nTherefore, we also considered a second implementation, where the individual subjects and the MNI152 template were directly registered using ANTs (Avants, Epstein, Grossman, & Gee, 2008; Avants, Tustison, & Song, 2009). More specifically, each GSP training subject's T1 image was directly registered to the MNI152 template using an affine transformation followed by Symmetric Normalization (Figure  a). Like RF\u2010M3Z, the mapping between each subject's cortical ribbon and fsaverage surface space was provided by FreeSurfer recon\u2010all (Figure  b). By concatenating the two transformations (Figure  a,b) for each subject, a mapping between MNI152 and fsaverage coordinate systems for each GSP training subject was obtained. By averaging across all 745 training subjects, a final mapping between MNI152 and fsaverage coordinate systems was obtained. This mapping is referred to as RF\u2010ANTs. It is important to note that this does not constitute a comparison of FreeSurfer and ANTs (Klein et al.,  ), as FreeSurfer is not being used in the way it was designed (i.e., individual subject analyses) in the case of RF\u2010M3Z. \n  \nRegistration fusion (RF\u2010ANTs) procedure. Each subject's T1 volume is mapped to the (a) MNI152 template and (b) fsaverage surface. By concatenating the mappings (a and b) for each subject and then averaging the deformations across all 745 training subjects, we created a mapping between MNI152 and fsaverage. Mapping (a) was generated using ANTs, so we refer to the resulting MNI152\u2010fsaverage mapping as RF\u2010ANTs [Color figure can be viewed at  ] \n  \n\n### Tight and loose cortical masks for fsaverage\u2010to\u2010MNI152 mappings \n  \nIt is worth mentioning an important asymmetry in the generation of the MNI\u2010to\u2010fsaverage and fsaverage\u2010to\u2010MNI mappings. When computing the MNI\u2010to\u2010fsaverage mapping, each subject yielded a mapping between   every   fsaverage vertex and   some   MNI location, which allowed for a simple averaging of MNI\u2010to\u2010fsaverage mappings across all 745 training subjects. By contrast, when computing the fsaverage\u2010to\u2010MNI mapping, not every training subject yielded a mapping between   every   MNI location and   some   fsaverage vertex because not every MNI location corresponded to the cerebral cortex of every subject. \n\nTherefore, when computing the fsaverage\u2010to\u2010MNI mapping, we defined two cortical masks. Figure   illustrates the two MNI152 masks and the difference between them. The tight cortical mask corresponded to the cortex for at least 50% of the subjects (Figure  a), while the loose cortical mask corresponded to the cortex for at least 15% of the subjects (Figure  b). For each tight cortical mask voxel (Figure  a), the fsaverage\u2010to\u2010MNI152 mappings were averaged across all subjects with valid fsaverage\u2010to\u2010MNI152 mappings for the voxel. The averaged mapping was then grown outwards to fill the entire loose cortical mask. More specifically, for each voxel outside the tight mask (but within the loose mask; Figure  c), its nearest voxel within the tight mask (Figure  a) was identified based on Euclidean distance. The voxel was then assigned the same fsaverage surface coordinates as its nearest voxel within the tight mask. Therefore, fsaverage surface data can be projected to fill up the entire loose cortical mask in the MNI152 template. This procedure was repeated for Affine, MNIsurf, RF\u2010M3Z and RF\u2010ANTs. \n  \nCortical masks for fsaverage\u2010to\u2010MNI152 mappings. (a) Tight cortical mask corresponding to 50% of the 745 GSP training subjects. (b) Loose cortical mask corresponding to 15% of the training subjects. (c) Difference between tight and loose cortical masks [Color figure can be viewed at  ] \n  \n\n### MNI152\u2010to\u2010fsaverage evaluation \n  \nTo evaluate the MNI152\u2010to\u2010fsaverage projection, let us consider a possible usage scenario. Researchers often project data (e.g., fMRI) from subjects\u2019 native spaces to MNI152 coordinate system for some form of group analysis. The outcome of the group analysis can be visualized in the volume, but is often projected to fsaverage surface for visualization. By contrast, data from subjects\u2019 native space can be directly projected to fsaverage surface for group analysis. The subjects\u2010to\u2010MNI152\u2010to\u2010fsaverage results should ideally be close to the subjects\u2010to\u2010fsaverage results. \n\nTo simulate the above scenario, recall that we have processed the 745 GSP test subjects using FreeSurfer recon\u2010all, yielding corresponding surface (lh.aparc.a2009s.annot and rh.aparc.a2009s.annot) and volumetric (aparc.a2009s\u2009+\u2009aseg.mgz) parcellations of 74 sulci and gyri per cortical hemisphere (i.e., Destrieux parcellation). Figure  a illustrates the superior temporal sulcus label in two GSP test subjects. The parcellation labels were projected to MNI152 coordinate system using ANTs and averaged across subjects, resulting in an ANTs\u2010derived volumetric probabilistic map per anatomical structure. The probabilistic maps simulated the group\u2010average results from typical fMRI studies. As an example, Figure  b illustrates the ANTs\u2010derived MNI152 volumetric probabilistic map of the superior temporal sulcus. \n  \nMNI152\u2010to\u2010fsaverage evaluation. (a) Parcellation labels from each subject were projected to (b) MNI152 and (c) fsaverage. The projected labels were averaged across subjects, resulting in a probabilistic map per anatomical structure in (b) MNI152 and (c) fsaverage, respectively. Figure shows superior temporal sulcus as an example. The latter maps in (c) fsaverage were used as \u201cground truth.\u201d The MNI152 probabilistic maps can then be projected to fsaverage surface using the various projection approaches (dotted arrow) for comparison with the \u201cground truth\u201d maps [Color figure can be viewed at  ] \n  \nThe MNI152 volumetric probabilistic maps (Figure  b) can then be projected to fsaverage surface using the various MNI152\u2010to\u2010fsaverage projection approaches (dotted arrow in Figure  ) for comparison with \u201cground truth\u201d surface probabilistic maps (Figure  c). The \u201cground truth\u201d surface probabilistic maps were obtained by averaging the surface parcellations across subjects in fsaverage surface space, mapped from each subject using FreeSurfer. As an example, Figure  c shows the \u201cground truth\u201d surface probabilistic map of the superior temporal sulcus. \n\nTo quantify the disagreement between the projected probabilistic map and the \u201cground truth\u201d surface probabilistic map of an anatomical structure, the normalized absolute difference (NAD) metric was used. The NAD metric was defined as the absolute difference between the two maps, summed across all vertices and divided by the sum of the \u201cground truth\u201d probabilistic map. This metric measured the dissimilarity between the two maps, normalizing for the size of the anatomical structure. A lower NAD value indicates better performance. \n\nFor every pair of approaches, the NAD metric for each of the 74 anatomical structures were averaged between the two hemispheres and submitted to a paired\u2010sample   t   test. Multiple comparisons were corrected using a false discovery rate (FDR; Benjamini & Hochberg,  ) of   q  \u2009<\u2009.05. All the   p   values reported in subsequent sections survived the false discovery rate. \n\n\n### fsaverage\u2010to\u2010MNI152 evaluation \n  \nTo evaluate the fsaverage\u2010to\u2010MNI152 projection, let us consider a possible usage scenario. It is unlikely that researchers would directly project individual subjects\u2019 fMRI data onto fsaverage surface space for group\u2010level analysis, and then project their results into MNI152 space for visualization. A more likely scenario might be the projection of surface\u2010based resting\u2010state fMRI cortical parcellations (Glasser et al.,  ; Gordon et al., 2016; Schaefer et al.,  ; Yeo et al.,  ) to MNI152 space. The projected resting\u2010state fMRI parcellation can then be utilized for analyzing new data from individual subjects registered to the MNI152 coordinate system. In this scenario, it would be ideal if the projected fsaverage\u2010to\u2010MNI152 resting\u2010state parcellation were the same as a parcellation that was estimated from resting\u2010state fMRI data directly registered to MNI152 space. \n\nTo simulate the above scenario, the Destrieux anatomical parcellation of each GSP test subject (Figure  a) was projected to fsaverage and combined into a winner\u2010takes\u2010all parcellation (Figure  b). The surface\u2010based parcellation can then be projected to MNI152 using the various fsaverage\u2010to\u2010MNI152 projection approaches (dotted arrow in Figure  ) for comparison with the \u201cground truth\u201d volumetric parcellation (Figure  c). The \u201cground truth\u201d volumetric parcellation was obtained by projecting the individual subjects\u2019 anatomical parcellations (Figure  a) into MNI152 space (using ANTs) and then combined into a winner\u2010take\u2010all parcellation (Figure  c). \n  \nfsaverage\u2010to\u2010MNI152 evaluation. (a) Parcellation from each subject was projected to (b) fsaverage and (c) MNI152. By combining the parcellations across subjects, winner\u2010takes\u2010all parcellations were obtained in (b) MNI152 and (c) fsaverage, respectively. The latter was used as \u201cground truth.\u201d The fsaverage winner\u2010takes\u2010all parcellation can be projected to MNI152 coordinate system using the various projection approaches (dotted arrow) for comparison with the \u201cground truth\u201d MN152 parcellation [Color figure can be viewed at  ] \n  \nTo quantify the agreement between the projected parcellation and the \u201cground truth\u201d parcellation, the Dice coefficient was computed for each of the 74 anatomical regions per hemisphere. A higher Dice value indicates better performance. \n\nFor every pair of approaches, the Dice metric for each of the 74 anatomical structures were averaged between the two hemispheres and submitted to a paired\u2010sample   t   test. Multiple comparisons were corrected using a false discovery rate (FDR; Benjamini & Hochberg,  ) of   q  \u2009<\u2009.05. All the   p   values reported in subsequent sections survived the false discovery rate. \n\n\n### Generalization to new data (CoRR\u2010HNU) and FSL FNIRT \n  \nThe RF mappings were derived using the GSP training set. To ensure the mappings generalize to new data, the above evaluations (MNI152\u2010to\u2010fsaverage and fsaverage\u2010to\u2010MNI152) were repeated using the CoRR\u2010HNU dataset. Furthermore, the previous evaluation procedures utilized ANTs to project subjects\u2019 anatomical parcellations to MNI152 (Figures  b and  c), resulting in possible biases in favor of RF\u2010ANTs. As such, the above evaluations were repeated using FSL FLIRT/FNIRT (Andersson et al.,  ). More specifically, FLIRT/FNIRT was utilized to project individual subjects\u2019 parcellation to MNI152 space to obtain FNIRT\u2010derived CoRR\u2010HNU MNI152 volumetric probabilistic maps (Figure  b) and FNIRT\u2010derived CoRR\u2010HNU MNI152 winner\u2010take\u2010all parcellation (Figure  c). \n\n\n### Registration fusion convergence \n  \nIn the previous analyses, as many training subjects as available (  N  \u2009=\u2009745) were used to construct the average mappings for the RF approaches. Here, we investigated the relationship between the accuracy of the RF approaches and the number of subjects used. More specifically, the MNI152\u2010to\u2010fsaverage evaluation (using ANTs\u2010derived GSP MNI152 maps) were repeated using RF mappings averaged across different number of subjects. \n\n\n### Colin27\u2010to\u2010fsaverage and fsaverage\u2010to\u2010Colin27 \n  \nThe previous mappings and evaluations were repeated for Colin27. In the case of the Affine approach, FreeSurfer does not provide a corresponding Colin27\u2010to\u2010fsaverage\u2010volume warp. Therefore, an affine warp was generated using FSL FLIRT. \n\nAs we are now working with the Colin27 template, the MNIsurf approach was renamed as Colin27surf. It should be noted that unlike that of the MNI152 template, the cortical ribbon of the Colin27 template is not abnormally thin (as it is a single\u2010subject template). However, using a single subject prevents the use of cross\u2010subject variance measures that can stabilize intersubject registration (Fischl et al.,  ). Therefore, we also expect registration errors between the cortical ribbon of a typical subject and Colin27. Consequently, Colin27surf does not take into account irreversible registration errors because it simply maps the cortical ribbon of Colin27 directly to fsaverage. \n\n\n\n## RESULTS \n  \n### MNI152\u2010to\u2010fsaverage projection \n  \nFigure   shows the projection of ANTs\u2010derived MNI152 probabilistic maps of four representative anatomical structures to fsaverage surface space for the GSP test set. Figure   shows the projection of FNIRT\u2010derived MNI152 probabilistic maps of four representative anatomical structures to fsaverage surface space for the CoRR\u2010HNU dataset. The black boundaries correspond to the winner\u2010takes\u2010all parcellation obtained by thresholding the \u201cground truth\u201d GSP or CoRR\u2010HNU fsaverage surface probabilistic maps. Visual inspection of Figures   and   suggests that the projected probabilistic maps corresponded well to the \u201cground truth\u201d for all approaches, although there was also clear bleeding to adjacent anatomical structures for the central sulcus and middle frontal sulcus. \n  \nVisualization of ANTs\u2010derived MNI152 probabilistic maps projected to fsaverage surface space in the GSP test set. Four representative structures are shown. Black boundaries correspond to the \u201cground truth\u201d winner\u2010takes\u2010all parcellation. The value below each cortical surface shows the normalized absolute difference (NAD) between projected probabilistic map and \u201cground truth\u201d probabilistic map, where a smaller value indicates better performances. Best NAD for each region is   bolded   [Color figure can be viewed at  ] \n    \nVisualization of FNIRT\u2010derived MNI152 probabilistic maps projected to fsaverage surface space in the CoRR\u2010HNU dataset. Four representative structures are shown. Black boundaries correspond to the \u201cground truth\u201d winner\u2010takes\u2010all parcellation. The value below each cortical surface shows the normalized absolute difference (NAD) between projected probabilistic map and \u201cground truth\u201d probabilistic map, where a smaller value indicates better performances. Best NAD for each region is   bolded   [Color figure can be viewed at  ] \n  \nThe NAD evaluation metric is shown below each brain in Figures   and  . A lower value indicates closer correspondence with the \u201cground truth\u201d probabilistic map. The NAD generally agreed with the visual quality of the projections, suggesting its usefulness as an evaluation metric. For example, in Figure  , the projection of the left ANTs\u2010derived middle posterior cingulate probabilistic map using RF\u2010ANTs visually matched the \u201cground truth\u201d black boundaries very well, resulting in a low NAD of 0.27. On the other hand, the corresponding projection using MNIsurf aligned well with the posterior\u2014but not the anterior\u2014portion of the \u201cground truth\u201d black boundaries, resulting in a worse NAD of 0.34 (Figure  ). \n\nFigure   shows the NAD metric averaged across all anatomical structures within each hemisphere. When ANTs\u2010derived GSP MNI152 probabilistic maps were used, RF\u2010ANTs was the best (  p  \u2009<\u2009.01 corrected). RF\u2010M3Z and MNIsurf showed comparable performance and were both significantly better than Affine (  p  \u2009<\u2009.01 corrected). When FNIRT\u2010derived CoRR\u2010HNU MNI152 probabilistic maps were used, RF\u2010ANTs were also the best (  p  \u2009<\u2009.01 corrected). RF\u2010M3Z and Affine showed comparable performance and were both significantly better than MNIsurf (  p  \u2009<\u2009.04 corrected and   p  \u2009<\u2009.02 corrected). To summarize, RF\u2010ANTs always performed the best. We note that hemispheric differences within each approach were not statistically significant (all   p  \u2009>\u2009.2). \n  \nNormalized absolute difference (NAD) of MNI152 probabilistic maps projected to fsaverage surface space. (Left) Results for ANTs\u2010derived GSP MNI152 probabilistic maps. (Right) Results for FNIRT\u2010derived CoRR\u2010HNU MNI152 probabilistic maps. The bars represent the NADs averaged across all 74 probabilistic maps within left hemisphere (black) and right hemisphere (white). Error bars correspond to standard errors across the 74 anatomical structures. Overall, RF\u2010ANTs performed the best \n  \n\n### Fsaverage\u2010to\u2010MNI152 projection \n  \nFigure   illustrates the projection of the fsaverage winner\u2010takes\u2010all parcellation to MNI152 volumetric space for the GSP test set, juxtaposed against black boundaries of ANTs\u2010simulated \u201cground truth\u201d segmentations. Figure   illustrates the projection of the fsaverage winner\u2010takes\u2010all parcellation to MNI152 volumetric space for the CoRR\u2010HNU dataset, juxtaposed against black boundaries of FNIRT\u2010simulated \u201cground truth\u201d segmentations. Figures  a and  a show the fsaverage\u2010to\u2010MNI152 projections before the dilation within the loose cortical mask (Section  ). Figures  b and  b show the fsaverage\u2010to\u2010MNI projections after the dilation, with insets illustrating example regions with obvious differences across methods. \n  \nWinner\u2010takes\u2010all fsaverage parcellation projected to MNI152 volumetric space with ANTs\u2010simulated \u201cground truth\u201d (black boundaries) in the GSP test set. (a) Projections before dilation within loose cortical mask. (b) Projections after dilation within loose cortical mask [Color figure can be viewed at  ] \n    \nWinner\u2010takes\u2010all fsaverage parcellation projected to MNI152 volumetric space with FNIRT\u2010simulated \u201cground truth\u201d (black boundaries) in CoRR\u2010HNU dataset. (a) Projections before dilation within loose cortical mask. (b) Projections after dilation within loose cortical mask [Color figure can be viewed at  ] \n  \nFigure   shows the Dice metric averaged across all anatomical structures within each hemisphere. In the case of GSP test set (using ANTs\u2010simulated \u201cground truth\u201d), RF\u2010ANTs were the best (  p  \u2009<\u2009.01 corrected). RF\u2010M3Z, MNIsurf and Affine all showed comparable performance. In the case of the CoRR\u2010HNU dataset (using FNIRT\u2010simulated \u201cground truth\u201d), RF\u2010ANTs and Affine were the best (  p  \u2009<\u2009.01 corrected). There was no statistically significant difference between RF\u2010ANTs and Affine. \n  \nDice of winner\u2010takes\u2010all fsaverage parcellation projected to MNI152 space, compared against (left) ANTs\u2010simulated GSP \u201cground truth\u201d and (right) FNIRT\u2010simulated CoRR\u2010HNU \u201cground truth.\u201d Bars represent dice coefficient averaged across all 74 segmentation labels within left hemisphere (black) and right hemisphere (white). Error bars correspond to standard errors \n  \nTo summarize, RF\u2010ANTs performed the best, although Affine also performed surprisingly well when FNIRT\u2010simulated CoRR\u2010HNU \u201cground truth\u201d was considered (Figure  , right). Visual inspection of Figure  a suggests that the projected cortical ribbon for Affine did not match well to the MNI152 cortical ribbon. However, the dilation within the loose cortical mask appeared to compensate for the poor mapping (Figure  b), leading to a competitive dice score (Figure  , right). \n\n\n### Registration fusion convergence \n  \nFigure   shows the average NAD metric within each hemisphere for projecting ANTs\u2010derived GSP MNI152 probabilistic maps to fsaverage space, plotted against the number of subjects used to construct the RF mappings. The NAD values start converging after about 100 subjects. When more than 300 subjects are used, the NAD values are mostly stable, although the right hemisphere for RF\u2010ANTs seems to require more subjects to converge. This suggests that the use of 745 training subjects is sufficient to guarantee the quality of the RF mappings. Nevertheless, the RF mappings that we have made publicly available utilize the entire GSP dataset to construct the mappings. \n  \nNormalized absolute difference (NAD) of ANTs\u2010derived GSP MNI152 probabilistic maps projected to fsaverage space as a function of the number of subjects used to create the RF mappings. (Left) RF\u2010ANTs. (Right) RF\u2010M3Z. NADs were averaged across all 74 probabilistic maps within left hemisphere (black) and right hemisphere (gray), and across all subjects in GSP test set. Results converge after about 300 subjects, although the right hemisphere for RF\u2010ANTs seems to require more subjects to converge \n  \n\n### Colin27\u2010to\u2010fsaverage and fsaverage\u2010to\u2010Colin27 projections \n  \nSupporting Information, Figures S1\u2013S3 show the Colin27\u2010to\u2010fsaverage projection results. The results are largely consistent with the MNI152\u2010to\u2010fsaverage results. In the case of the GSP test set (using ANTs\u2010derived volumetric probabilistic maps), RF\u2010ANTs was the best (  p  \u2009<\u2009.01 corrected). RF\u2010M3Z and Colin27surf showed comparable performance and were both significantly better than Affine (  p  \u2009<\u2009.01 corrected). In the case of the CoRR\u2010HNU dataset (using FNIRT\u2010derived Colin27 volumetric probabilistic maps), RF\u2010ANTs was also the best (  p  \u2009<\u2009.01 corrected). RF\u2010M3Z was the second best (  p  \u2009<\u2009.01 corrected), followed by Affine (  p  \u2009<\u2009.01 corrected). Hemispheric differences within each approach were not statistically significant (all   p  \u2009>\u2009.1). To summarize, RF\u2010ANTs always performed the best. \n\nSupporting Information, Figures S4\u2013S6 show the fsaverage\u2010to\u2010Colin27 projection results. The results are largely consistent with the fsaverage\u2010to\u2010MNI152 results. In the case of the GSP test set (using ANTs\u2010derived \u201cground truth\u201d), RF\u2010ANTs was the best (  p  \u2009<\u2009.01 corrected). While Colin27surf showed better performance than RF\u2010M3Z (  p  \u2009<\u2009.01 corrected), both of them showed (statistically) comparable performance with Affine. On the other hand, in the case of the CoRR\u2010HNU dataset (using FNIRT\u2010derived \u201cground truth\u201d), both RF\u2010ANTs and RF\u2010M3Z showed (statistically) comparable performance with Affine. Nevertheless, RF\u2010ANTs showed better performance than RF\u2010M3Z (  p  \u2009<\u2009.01 corrected). Colin27surf performed the worst (  p  \u2009<\u2009.01 corrected). To summarize, RF\u2010ANTs performed the best, although Affine also performed surprisingly well when FNIRT\u2010simulated CoRR\u2010HNU \u201cground truth\u201d was considered. Similar to the previous section, the dilation within the loose cortical mask compensated for the actually poor Affine mapping. \n\n\n\n## DISCUSSION \n  \nIn this article, various approaches (Affine, MNIsurf/Colin27surf, RF\u2010M3Z and RF\u2010ANTs) for mapping between MNI/Colin27 and fsaverage were quantitatively evaluated. RF\u2010ANTs performed the best. \n\nOur results showed that RF\u2010ANTs compared favorably with RF\u2010M3Z, MNIsurf/Colin27surf and Affine even when FSL FNIRT was used to set up the evaluations using a dataset different from the one utilized to derive RF\u2010ANTs. This suggests that if a different software (other than ANTs) was used to register data to MNI152 space, it would still be preferable to use RF\u2010ANTs (rather than RF\u2010M3Z, MNIsurf, or Affine) to map the resulting data to fsaverage space. Nevertheless, to achieve best performance, if SPM was used to register data to MNI152 space, then it would probably be the most optimal to generate a new set of RF transformations using SPM. \n\nOne potential concern is that the RF mappings are expensive to create because it requires registering a large number of subjects. However, we note that this is a one\u2010time cost. To alleviate this one\u2010time cost, RF\u2010M3Z and RF\u2010ANTs mappings generated using all 1490 GSP subjects are available at  . The code to replicate the mappings or generate new mappings can be found at the same repository. \n\nRecent work has proposed integrating surface\u2010based and volumetric registration to obtain the advantages of each (Joshi, Leahy, Toga, & Shattuck,  ; Postelnicu, Zollei, & Fischl,  ; Zollei, Stevens, Huber, Kakunoori, & Fischl,  ). These combined\u2010volume\u2010surface registration algorithms either used both cortical features and volumetric intensity to drive the alignment simultaneously (Joshi et al.,  ) or used geometric information from a surface\u2010based warp to initialize the volumetric alignment (Postelnicu et al.,  ; Zollei et al.,  ). However, these methods were usually designed with inter\u2010subject registration in mind. The combined\u2010volume\u2010surface registration algorithms can be used to create a joint surface\u2010volumetric template, in which the surface and volumetric surface coordinate systems are in alignment. However, creating a new coordinate system would not be helpful for researchers with existing data in MNI152/Colin27 and fsaverage coordinate systems. \n\nThe RF approaches might also potentially benefit from improving the registration between subjects and the common coordinate systems (e.g., MNI152). As the RF approaches can be easily adapted to new registration methods, future work can explore more variants of the RF approach. For example, by restricting the registration between subjects\u2019 native space and MNI152/Colin27 to geodesic paths in an anatomical manifold (Hamm et al.,  ), we might be able to generate a better final mapping. \n\nIn summary, the RF\u2010ANTs projections between MNI152/Colin27 and fsaverage worked surprisingly well. For example, the projected anatomical structures fitted the ground truth boundaries very well (Figure  ), although there were clear, but minor misregistrations across sulci. The advantage of registration fusion is consistent with the image segmentation literature, which has demonstrated that using multiple registrations for label fusion can improve image segmentation because the multiple registrations capture greater inter\u2010subject variability and protect against occasional registration failures (Aljabar, Heckemann, Hammers, Hajnal, & Rueckert,  ; Collins & Pruessner,  ; Heckemann, Hajnal, Aljabar, Rueckert, & Hammers,  ; Iglesias & Sabuncu,  ; Sabuncu, Yeo, Van Leemput, Fischl, & Golland,  ; Wang et al.,  ). \n\nOverall, we believe that the RF approach is useful for projecting between volume and surface coordinate systems. However, we emphasize that the best way of mapping data to fsaverage is by registering subjects directly to fsaverage, while the best way of mapping data to MNI152/Colin27 is by registering subjects directly to the corresponding volumetric template. When data in individuals\u2019 native spaces are available, researchers should not use the RF approaches to project individuals\u2019 data between MNI152/Colin27 and fsaverage for convenience. The RF approaches evaluated in this article can be considered when the optimal approach is not possible (e.g., when running FreeSurfer on individual subjects is not possible). Furthermore, care must be taken when interpreting results. For example, when describing MNI152 results that have been projected to fsaverage for visualization, it is important to verify that the description is consistent with the original volumetric data in MNI152 space. \n\n\n## CONCLUSION \n  \nIn this article, we compared various approaches for mapping between MNI152/Colin27 volumetric and fsaverage surface coordinate systems. We found that a new implementation of the RF approach (Buckner et al.,  ; Yeo et al.,  ), RF\u2010ANTs, performed the best. Nevertheless, it is worth noting that the most optimal approach for mapping data to a particular coordinate system (e.g., fsaverage) is to register individual subjects directly to the coordinate system, rather than via another coordinate system. However, in scenarios where the optimal approaches are not possible (e.g., mapping previously published results from MNI152 to fsaverage), we recommend using RF\u2010ANTs. The RF approach can be easily adapted for other volumetric and surface coordinate systems. Code and transformations from this article can be found at  . \n\n\n## Supporting information \n  \n \n", "metadata": {"pmcid": 6239990, "text_md5": "3bc44ac8288c6529eebfd256e081565a", "field_positions": {"authors": [0, 138], "journal": [139, 153], "publication_year": [155, 159], "title": [170, 261], "keywords": [275, 366], "abstract": [379, 2202], "body": [2211, 44344]}, "batch": 1, "pmid": 29770530, "doi": "10.1002/hbm.24213", "pmc_url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6239990", "efetch_url": "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pmc&id=6239990"}, "display_title": "pmcid: <a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6239990\">6239990</a>", "list_title": "PMC6239990  Accurate nonlinear mapping between MNI volumetric and FreeSurfer surface coordinate systems"}
