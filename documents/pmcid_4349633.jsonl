{"text": "Harrison, Samuel J. and Woolrich, Mark W. and Robinson, Emma C. and Glasser, Matthew F. and Beckmann, Christian F. and Jenkinson, Mark and Smith, Stephen M.\nNeuroimage, 2015\n\n# Title\n\nLarge-scale Probabilistic Functional Modes from resting state fMRI\n\n# Keywords\n\nResting state fMRI\nFunctional parcellation\nBayesian modelling\nSubject variability\nICA\n\n\n# Abstract\n \nIt is well established that it is possible to observe spontaneous, highly structured, fluctuations in human brain activity from functional magnetic resonance imaging (fMRI) when the subject is \u2018at rest\u2019. However, characterising this activity in an interpretable manner is still a very open problem. \n\nIn this paper, we introduce a method for identifying modes of coherent activity from resting state fMRI (rfMRI) data. Our model characterises a mode as the outer product of a spatial map and a time course, constrained by the nature of both the between-subject variation and the effect of the haemodynamic response function. This is presented as a probabilistic generative model within a variational framework that allows Bayesian inference, even on voxelwise rfMRI data. Furthermore, using this approach it becomes possible to infer distinct extended modes that are correlated with each other in space and time, a property which we believe is neuroscientifically desirable. \n\nWe assess the performance of our model on both simulated data and high quality rfMRI data from the Human Connectome Project, and contrast its properties with those of both spatial and temporal independent component analysis (ICA). We show that our method is able to stably infer sets of modes with complex spatio-temporal interactions and spatial differences between subjects. \n   Highlights  \n  \nWe introduce a probabilistic model for modes in resting state fMRI. \n  \nOur hierarchical model captures subject variability and haemodynamic effects. \n  \nWe illustrate its performance on simulated data and rfMRI data from 200 subjects. \n  \nWe demonstrate the ability of our method to infer spatio-temporally interacting modes. \n  \n \n\n# Body\n \n## Introduction \n  \nUsing resting state fMRI it is possible to generate enormously rich data sets that capture some of the complexity of the brain's intrinsic dynamics and connectivity. However, generating representations that meaningfully simplify the data, while still capturing these dynamics, is an immensely challenging problem. \n\nInitial analyses of rfMRI data focused on finding regions of highly correlated activity ( ), with spatial independent component analysis (sICA) coming to prominence as a robust method for extracting regions consistent with knowledge from task analyses ( ). \n\nRecently, there has been much interest in techniques which analyse functional connectivity across the brain, including the potentially time-varying or non-stationary nature of these connections ( ). However, for all but the simplest analysis techniques it is necessary to work in a lower dimensional space than the hundreds of thousands of voxels in a typical rfMRI data set. This is typically achieved either by extracting parcels from an anatomical atlas, or using high-dimensional sICA ( ). However, it is well known that \u201c[i]nconsistent or imprecise node definitions can have a major impact on subsequent analyses\u201d ( ), which again throws the question of how best to generate meaningful representations of resting state activity into sharp relief. \n\nTherefore, an aim has become to find an interpretable and robust way of representing rfMRI data, at the same time as capturing as much of the complex temporal dynamics as possible. \n\n### Definitions \n  \nFor this paper, we will use the following definitions. We will take a   network   to be a set of interacting elements\u2014synonymous with the mathematical formalism of a graph as a set of nodes and edges. Functional connections, that is to say the edges between nodes, may vary in their presence and strength over time. \n\nWe define a   parcel   to be a set of voxels acting with a single representative time course. These are often derived from a \u2018hard\u2019 parcellation of grey matter into multiple non-overlapping regions ( ). However, given the trend for using components from a high-dimensional sICA for connectivity analyses ( ), we relax this definition slightly. In the spatial domain, a parcel is taken to represent a set of positive weights, potentially varying in magnitude, with limited overlap between different parcels. The definition we have given therefore allows, for example, blurred boundaries or parcels that contain bilaterally paired regions. \n\nWe define a   mode   as any spatial distribution over the brain that shares a common time course. This is similar to a parcel, but the definition is wider as this imposes no restrictions on the spatial properties. For example, multiple modes can be highly overlapping, and individual modes can include anti-correlated regions (meaning that some regions within the mode have a negative spatial weight and others have a positive one). A mode\u2014as an extended spatial distribution having common temporal dynamics\u2014can be defined either in terms of a spatial voxelwise map, or as a weighted set of spatial parcels. \n\nIn general, it is possible to take the time courses from either parcels or modes and use these as the nodes to examine in a subsequent network analysis, but we will focus on modes here. \n\n\n### Current methods \n  \nMany techniques have been proposed to identify modes or parcels. Perhaps the simplest is to extract time courses from labelled regions in a pre-defined anatomical atlas, though the validity of this has been called into question as the correspondence between anatomical landmarks and functional regions is unclear ( ). The obvious alternative is to use a pre-defined atlas containing regions based on previous functional studies, an approach which is likely to have a higher validity. \n\nHowever, the arguable weakness of atlas-based approaches is their reliance on the registration process to enforce consistency across subjects. There is an enormous amount of interesting structure present in rfMRI data, and it seems reasonable to assume that this could be harnessed to inform the specification of functional regions. In fact, one of the key assertions we make in this paper is that it is possible to attempt to use the characteristics of the rfMRI data to correct for subject mis-alignments. \n\nThere have therefore been a large number of strategies proposed that attempt to infer functional regions from the data\u2014so called \u2018data-driven\u2019 approaches. Temporally consistent co-activation is the implicit assumption that defines both parcels and modes, but by itself this does not lead to a unique decomposition. Therefore, it is necessary to add additional constraints to make the inference problem identifiable. \n\nThe most widely used data-driven approach is to look for modes that are independent using ICA. Due to the large numbers of voxels and relatively few time points of early studies, spatial ICA gave the most robust decompositions and therefore became the dominant approach. However, almost as soon as it was introduced, concerns were raised. Given that \u201c[distinct] large scale neuronal dynamics can share a substantial anatomical infrastructure\u201d ( ), it is unclear how well sICA will decompose extended modes that spatially overlap. These concerns were allayed to some extent by Beckmann et al., who showed that in the presence of noise ICA components can still contain strong residual dependencies, and highly correlated maps can be recovered by a simple thresholding step ( ). What is perhaps less clear is what, if any, biases are introduced when the data has a high SNR or when large groups are analysed, both cases where the inferred maps are expected to contain very little noise. \n\nAn alternative approach is to look for temporally independent modes, which has recently become possible as studies of large cohorts acquired at low TR have generated enough time points for temporal ICA (tICA) to operate robustly ( ), albeit still most likely requiring the concatenation of several fMRI data sets to achieve reasonable reproducibility. This allows spatially overlapping modes to be identified, at the expense of placing restrictions on the global temporal dynamics\u2014as well as this being a concern in and of itself, this restriction will also limit any subsequent network analyses of the mode time courses. As Smith et al. discuss, temporally independent functional modes (TFMs) are forced to have orthogonal time courses, meaning that further analysis of the temporal interactions between different modes is not straightforward ( ). \n\nAs well as the choice of spatial or temporal independence, various extensions have been proposed to extract meaningful subject-specific information from group ICA decompositions ( ). \n\nWhile each ICA strategy has its own advantages, the fundamental issue with all ICA-based approaches is that \u201cit is not clear that, from a neuroscientific point of view, independence is the right concept to isolate brain networks, as no functional system is fully segregated\u201d ( ). What is perhaps surprising is how demonstrably well ICA approaches work, given that their central assumptions are often violated ( ); for example, forms of ICA have been developed that explicitly incorporate information derived from the residual statistical dependencies between components ( ). Therefore, while ICA approaches have been particularly useful for characterising fMRI data, one would hope that a less restrictive set of assumptions could engender decompositions with even higher validities. \n\nOther data-driven approaches suggested have had varying degrees of success. Many are based on machine learning techniques, where the key assumptions underpinning the algorithms are only loosely related to the expected properties of rfMRI data. These include clustering approaches ( ), regularised variants of principal component analysis (PCA) ( ), non-negative matrix factorisation ( ), image gradient detection in correlation maps ( ) and hidden Markov models ( ) to name but a few. \n\nFinally, there are a few approaches which try to explicitly model rfMRI data. The multi-subject dictionary learning (MSDL) approach of   forms a model that explicitly looks for modes/parcels, and there are some conceptual similarities with our approach. Their algorithm contains a hierarchical model for spatial subject variability, a constraint favouring simultaneously smooth and sparse spatial distributions as well as the ability to capture the temporal correlations between modes. \n\nDue to the similarities between our approaches, we will give a brief description of the most recent version of their model, of which more details can be found in the work of  . Their spatial model at the group level is detailed, simultaneously enforcing non-negativity, sparsity and spatial contiguity. The subject maps are modelled by including a set of additive, Gaussian-distributed deviations from the group maps. Their time series model specifies that there should be a consistent between-mode correlation structure but does not restrict the form of the time series; therefore, it does not model any haemodynamic processes. Finally, these constraints are combined with a noise model, and the resulting cost-function governing their decomposition is solved with a computationally efficient stochastic gradient descent approach. The most recent results they report are on an rfMRI data set consisting of 48 subjects. \n\nIn this paper, we develop an analysis technique that explicitly models some of the key properties of resting state modes within a Bayesian framework. The Bayesian approach allows very flexible models to be constructed in a principled manner; crucially, we solve the system using a variational approach, thereby making the algorithm efficient enough to work on full fMRI data sets. \n\nThe paper is structured as follows. First, we describe our model and the approaches needed to maintain tractability when doing Bayesian inference. We then present our results, including both verification on simulated data and details of the modes inferred on fMRI data from the Human Connectome Project ( ) (HCP). Finally, we discuss the implications of our results and key areas for future investigation. \n\n\n\n## Model \n  \nWe aim to identify extended functional modes which are not restricted to being orthogonal, or non-overlapping, to each other in space or in time. In general terms, we define a hierarchical model that allows us to flexibly capture the spatial variation of modes across subjects, while still keeping track of key properties at the group level. We simultaneously enforce that the temporal characteristics of modes must relate to the haemodynamics that drive the BOLD signal. Finally, by doing inference in a Bayesian setting, the extent to which our modes explain the data is automatically traded off against how well they align with our prior beliefs. \n\nAs the modes we infer are defined by the generative model outlined below, we will refer to them as probabilistic functional modes (PFMs). \n\nThe model is built on the same matrix factorisation approach that underpins PCA, ICA, non-negative matrix factorisation and several other well established methods for analysis of rfMRI. The approach is to decompose an fMRI run into the product of two matrices, which in the case of rfMRI are interpreted as a set of mode spatial maps and time courses respectively. \n\nThe fMRI data are acquired with   V   voxels and   T   time points, giving the data matrix    D    for a single run. If we infer a set of   M   PFMs then we look for spatial maps,    P   , and time courses    A   . In general we infer a small number of PFMs relative to   V   and   T  , which gives a parsimonious set of modes. However, this means that the factorisation will not be exact, so we express the data as the contribution from the PFMs and a noise term,   \u03b5  , to give \n\nIn order to infer both the group-level properties and any interesting subject variability, we explicitly account for the full set of all runs,  . This contains data from each subject within the set of subjects   S  , and in general each subject,   s  , will have a set of multiple runs   R  . \n\nWe then assume that the noise and time courses will be randomly varying in each run, but that each subject has a set of mode spatial maps that are consistent across all their runs. This extends Eq.\u00a0  to give \n\nTo formulate this as a probabilistic model we place priors on both the PFM spatial maps and time courses, as well as modelling the contribution from the noise. The forms of these distributions are explained in the following sections. \n\n### Spatial prior \n  \nFor each voxel   v   in the spatial map of PFM   m   we want to assess whether, given the noise level and time course, the data supplies enough evidence to suggest that there is genuinely an effect present in that voxel. There is a direct conceptual link between this approach and the traditional approach of significance testing within the general linear model framework for task fMRI data. \n\nIf there is insufficient evidence a posteriori for an effect we should just set the weight at that voxel to zero. However, if there is evidence for an effect, then we are interested in both its size and how it varies over subjects. \n\nTo express this model probabilistically, we formulate a delta-Gaussian mixture model, a natural extension of the spike-slab distribution ( ). This contains a delta component at zero to capture the effects that are not present or too weak to be observed, and a Gaussian to model the observable effects and their variability over subjects. This is parameterised by the probability of an effect being present, \u03c0, as well as the mean,   \u03bc  , and standard deviation,   \u03c3  , of the Gaussian. There is also a binary indicator variable,   q  , to capture which component each weight is drawn from. Crucially, we have placed no explicit prior on the relationship between the spatial distributions of different modes, so there is no explicit penalty on voxels being present in multiple modes. Similarly, the fact that the non-zero weights are drawn from a Gaussian means that they can be either positive or negative, thereby allowing modes containing anti-correlated regions\u2014if the data supports that inference. This has the form given in Eq.\u00a0  and is shown graphically in  . Note that the inference on this model automatically combines the evidence from each of the runs available for a given subject, weighted to take into account the signal to noise ratio of the time courses. \n\nThe three parameters at each voxel, \u03c0,   \u03bc   and   \u03c3  , parameterise the distribution of the observed spatial maps over subjects. They succinctly capture our beliefs about the answers to three very pertinent questions: does a voxel contribute to a given PFM? If so, how big is the contribution and how much does it vary from subject to subject? \n\nAs is standard, we place a beta-hyperprior on \u03c0 and an inverse gamma hyperprior on   \u03c3  . Finally, we place a spike-slab hyperprior on each mode's voxelwise means, with precision   \u03b3   and sparsity   \u03bb  , as in Eq.\u00a0 . \n\nThe spike-slab hyperprior allows us to regularise the group spatial maps, if required, by altering the   \u03bb   parameter. Intuitively,   \u03bb   represents the proportion of voxels we expect to be non-zero a priori in each mode's group level spatial map. In reality, as we expect modes to be spatially distributed and overlapping, we set   \u03bb  \u00a0>\u00a0  M  . \n\nNote that when we present group maps we show the marginal posterior mean of the whole spatial distribution,  , rather than just the   \u03bc   parameters. \n\n\n### Temporal prior \n  \nWhen looking at rfMRI data, the spectral characteristics of the neurally-driven BOLD signal are dominated by the haemodynamic response function (HRF). In other words, we know that any non-artefactual mode time courses we observe will be dominated by low frequencies, almost regardless of the frequency content of the underlying neuronal processes. \n\nTherefore, we formulate a temporal prior that captures the auto-correlation induced by the HRF. For a neuronal signal,   x  (  t  ), and a linear HRF,   h  (  t  ), the observed signal   y  (  t  ) is a simple convolution of   x  (  t  ) and   h  (  t  ). If we assume that the neuronal process is white on the time scale of the fMRI acquisitions then it is straightforward to show that the auto-correlation induced in the observed signal is just the auto-correlation of the HRF, namely \n\nWe assume a canonical double-gamma HRF and use this correlation structure to construct a full covariance matrix,    K   , for all the time points in a given run. We also place a standard inverse gamma hyperprior,   \u03b1  , on the overall precision. Therefore, the prior on the time course for PFM   m  , which we denote    A   \u00a0\u2208\u00a0  \u211d  , becomes \n\nOf course, it is well known that the HRF is both highly variable and much more complex ( ) than the canonical linear HRF assumed here. However, this is a probabilistic prior, rather than a hard constraint, so there is scope for the inferred time courses to match the temporal structure in the data. Similarly, this form of prior on the covariance structure is predicated on a white neuronal process. Some current theories, based on evidence from electrophysiology ( ) and biophysical models ( ), predict that the neural basis of rfMRI activity is correlations between the envelopes of higher frequency signals, where these amplitude correlations occur at \u2018ultraslow\u2019 timescales (biased towards frequencies less than 0.1\u00a0Hz). On the other hand, current evidence suggests that neuronal process are white over the range of frequencies estimable at typical fMRI sampling rates ( ) and that structure, consistent with the rfMRI literature, is present at surprisingly high frequencies ( ). \n\nGiven the wide range of temporal models present in the literature, we make the pragmatic decision to choose a very simple linear model to capture the gross properties of the HRF and rely on the Bayesian inference procedure to be flexible enough to capture some of the more complex properties. This also has the advantage of being computationally efficient. \n\n\n### Noise model \n  \nThe final part of the model to specify is the noise. This is simply white Gaussian noise with a mean for each voxel,   v  . The overall noise precision for each run,   \u03c8  , takes a standard gamma hyperprior, while the mean has a Gaussian hyperprior. \n\n\n### Variational inference \n  \nThe aim is then to carry out Bayesian inference on this model. However, calculating the full posterior analytically is intractable and a sampling procedure for a model with this many parameters would be prohibitively slow. \n\nTherefore, we use a variational approach. In this framework the posterior is chosen to take a simplified, parameterised form, with the parameters chosen to best approximate the true posterior. We denote the simplified posterior distributions   q  (  x  ), and in this case the approximation we make is to factorise the posterior over the variables,   \u0398  , to give \n\nWhile this is an approximation, it is very efficient and allows us to do Bayesian inference over large sets of rfMRI runs simultaneously. \n\nOf course, while this approximation allows us to proceed, it introduces a deviation from the true posterior and the implications of this are very hard to quantify. This reinforces the need to evaluate the results critically. Our tests with simulations and real data, described later, lead us to believe that the effects of this approximation are not too pernicious. \n\nAs we have taken all of our distributions from the conjugate exponential family the variational update rules are somewhat routine ( ); therefore, we will not provide them in the body of this paper but in the Supplementary material. This also contains the graphical model and the values of the parameters we use for the prior distributions for both simulations and real data. \n\n\n### Model identifiability \n  \nThe identifiability of our decomposition is guaranteed by virtue of a non-Gaussian spatial prior, as is the case with both sICA and MSDL, amongst many others. However, this does not imply an equivalence between decompositions as all three models have fundamentally different formulations of this spatial prior. Furthermore, compared to sICA, both our approach and MSDL explicitly model subject variability, \n\nOur HRF-based prior on the time courses strongly predisposes the decomposition to identify modes that are neural in origin, rather than those which represent structured artefacts. However, the time course prior is rotationally invariant across modes. Therefore, it can only help identify the subspace the BOLD signal resides in, but crucially does not aid in the unmixing of the modes. This limitation arises because of the assumption of a linear HRF operating on independent neural time courses. Intuitively, if the set of inferred time courses are all consistent with the frequency spectrum implied by our HRF, then any linear combination of said time courses would satisfy our temporal constraints equally well. \n\nFinally, our method works on the full data. ICA, for example, normally operates in a reduced PCA subspace, of the same rank as the final decomposition, and is therefore completely reliant on the PCA step to separate the BOLD signal and the noise. It seems somewhat unlikely that the PCA step will perfectly separate the two, and this is deleterious as the ICA components will be contaminated by any noise that enters the PCA subspace, while they will be \u2018blind\u2019 to any genuine signal that is excluded by the PCA step. While there is a computational trade-off, a more holistic approach, modelling both the BOLD signal and the noise simultaneously, seems to be attractive. \n\n\n\n## Results \n  \n### Simulated data \n  \nIn order to test the efficacy of our method we simulated an fMRI data set containing an embedded ground truth set of modes. This allows us to compare the accuracy of our model against other commonly used approaches, under the assumptions of the simulations. \n\n#### Data generation \n  \nThe data was simulated to represent a scaled-down version of the HCP acquisition protocols, where each subject was scanned four times for 15\u00a0minutes at a TR of 0.72\u00a0s, yielding 4800 time points per subject. However, as we are looking to repeatedly simulate data of this form, only 12,500\u00a0voxels and 30 subjects\u2014representing 144,000 time points\u2014are simulated. This is compared to the actual set of 90,000 HCP \u2018grayordinates\u2019 and over 500 subjects released to date. This represents a data reduction by approximately a factor of 7 in both the spatial and temporal domains compared to the HCP data set we use in subsequent analyses. While somewhat arbitrary, this yields test data sets that are computationally manageable, while having the same ratio of spatial to temporal data points as in the HCP and where the various test\u2013retest reliabilities are consistent with what we observe on the real data. \n\nThe mode activity itself was simulated as follows and this process is outlined schematically in  . What follows is a brief description of the salient properties of our simulations. A much more detailed account, along with all the parameter values used and some examples of typical simulated data, can be found in the Supplementary material. \n\nFirstly, a spatial \u2018atlas\u2019, of 200 binary, non-overlapping, continuous, random parcels was generated, mimicking a one-dimensional hard parcellation model. Random, smooth spatial warps were applied to generate subject-specific versions of the group atlas, with the maximum possible spatial shift limited to 1.5 times the average parcel width\u2014in this case just under 100\u00a0voxels. These warps are meant to be a simplified representation of both instances where the registration does not bring regions into alignment, and instances of genuine topological reorganisation. \n\nThe spatial distribution of 25 modes was specified as a sparse set of weights, describing how strongly each parcel was associated with each mode. The weights could be positive or negative, thereby allowing modelling of within-mode anti-correlations. There was also a preference for mode weights to be similar in adjacent parcels. This generates modes with greater continuous spatial extent than individual parcels, increasing the robustness to misalignments at the parcel level. The mode sparsities were beta-distributed, with mean 0.08 and variance 7.5\u00a0\u00d7\u00a010 . Each mode is therefore associated with about 16 parcels on average or, in other words, each parcel was present in about 2 modes. Finally, subject-specific mode weights were generated by adding a sparse set of deviations around the group weights. A simple matrix multiplication of the parcel atlas by the mode weights gives the mode maps in voxel space. \n\nIn the temporal domain, mode time courses were simulated before the action of the HRF, at a temporal resolution of 0.1\u00a0s. These time courses were not white, but had an increased power spectral density at less than 0.1\u00a0Hz; as mentioned previously, this allows us to investigate how our model performs when the implicit assumption of a white neuronal process is violated. There was a group-level pattern of temporal correlations between modes, though there were variations at both the subject and run level. Finally, the time courses were thresholded based on amplitude, such that the smallest 80% of time points were set to zero, to introduce temporal non-Gaussianities. \n\nTo illustrate the strength of the induced correlations between modes, we plot a set of both spatial and temporal correlation coefficients from a single simulated subject in  . Note that the presence of non-zero correlations between the ground truth modes, both spatially and temporally, goes against prior constraints in PCA/ICA models, but we believe that this makes neuroscientific sense. \n\nIn order to generate the BOLD signal, the neuronal activity in each voxel was calculated using the mode time courses, weights and the spatial atlas. These voxel time courses were then convolved with a linear HRF\u2014this was randomly drawn from a basis set and varied over both subjects and space ( ). A nonlinear saturation function, loosely based on a second-order Volterra kernel approximation ( ), was then applied. Finally, spatio-temporally white noise was added to achieve an overall signal to noise ratio of \u2212\u00a010\u00a0dB. \n\n\n#### Methods and scoring \n  \nWe compared the PFMs inferred by our method to the modes recovered by PCA, sICA, tICA and stICA. The stICA approach has two main steps: sICA is used to find the 200 parcels in the spatial atlas, before tICA is used to identify the modes in this reduced space. The results from these two steps are then combined to recover the mode maps in voxel space and, like the other methods, stICA is only scored based on the recovery of the modes. Note that stICA was the approach used by Smith et al. when characterising TFMs with tICA ( ). The ICA techniques used the FastICA toolbox ( ) and were compared before and after a final dual regression step ( ), a technique for estimating subject-specific versions of group-level modes. \n\nThe results we present here are from tests where all methods were tasked with identifying the set of 25 ground truth modes. Of course, it is specious to assume that the \u2018true\u2019 number of modes is known, so the Supplementary material contains results for cases where methods were asked to recover either 15 or 40 modes. This allows us to assess how robust the methods are to misspecification of the number of modes, which is likely to be the case on real data. \n\nMethods were scored on how accurately they recovered the subject-specific spatial maps and time courses, as well as how accurately they could recover the between-mode spatial and temporal correlation structures. Furthermore, the methods were run twice on each simulated data set. This allowed us to assess the relationship between test\u2013retest reliability and accuracy relative to the ground truth. \n\nWe use a correlation coefficient to score the accuracy of the recovery of the spatial maps and time courses for the different methods. For this paper we use the sample Pearson correlation coefficient, with the slight modification that we do not remove means. We have taken this approach because the matrix factorisation, while being ambiguous with regard to the relative scalings of the maps and time courses, is not invariant to shifts in the means. Modes were matched to the ground truth using the Hungarian algorithm ( ) based on the sum of the map and time course scores. \n\nOnce modes have been paired with their nearest ground truth counterparts, we calculate the decomposition accuracies. In the spatial domain this is the correlation between the inferred and true versions of the subject-specific maps, and the correlations between true and estimated time courses in the temporal domain. We present the mean, over subjects, of these correlations for each mode in the figures. \n\nIn order to evaluate how well methods recovered the inter-mode correlation structures, we recorded the RMS error between each element of the inferred and ground truth correlation matrices; again, this is calculated separately for spatial and temporal correlation coefficients and takes into account the pairing of the inferred modes to the ground truth. In this case, the mean used to calculate the RMS error is again taken over subject-specific correlation matrices. \n\nTest\u2013retest scores were calculated using the same method as above, except that rather than comparing the ground truth and inferred mode maps, the two sets of maps resulting from different random initialisations of the various algorithms were matched and scored. Note that test\u2013retest reliability is distinct from, though closely related to, split-half reproducibility, a metric commonly used to evaluate the reliability of components from real data ( ). As we use these simulations to evaluate the relationship between test\u2013retest reliability and ground truth accuracy, we will persist with this as our performance metric on real rfMRI data. \n\n\n#### Results \n  \n contains the scores that capture how accurately the various methods recovered the ground truth modes. These results are compared with the test\u2013retest reliability for four of the methods we tested in  . \n\nOut of the traditional ICA approaches, sICA is by some distance the most accurate. This is perhaps somewhat surprising given that these simulations are based around modes, rather than parcels, and that there are far more time points than voxels. However, the spatial map distributions are strongly non-Gaussian and the sICA decompositions are very robust, leading us to believe that, for these simulations, the limiting factor for sICA is the restriction that the solution has to lie on the manifold of uncorrelated maps. \n\nBoth tICA and stICA perform relatively poorly. It has long been known that with small numbers of time points tICA is much less robust than sICA ( ); however, each of our simulated data sets has over five times as many time points as the data set used in the paper which introduced tICA as a method for identifying modes from rfMRI data ( ), so we would not expect this to be the limiting factor. Again, restricting the search space to temporally uncorrelated modes is bound to be detrimental. However, this problem is compounded by the blurring action of the HRF severely reducing the strength of the observable temporal non-Gaussianities. Finally, in this case the two-step stICA approach does not seem to improve performance compared to running tICA directly. However, it seems likely that some of the key benefits of this approach on real data, for example the ability to remove artefactual components at the sICA stage or to renormalise parcel time courses that are acquired in regions with different sensitivities, are not being fully captured by our simulations. \n\nFor all the ICA approaches, dual regression allows the inference of subject specific maps and time courses, offering only modest improvements in performance in the spatial domain. \n\nOur method performs the most accurately out of the various methods on test here\u2014it is able to infer both temporally and spatially correlated features reliably from this data. However, what is particularly encouraging is the lack of systematic bias in the inferred PFMs, as illustrated in  a. Ground truth accuracy is strongly correlated with test\u2013retest reliability, a property one expects where estimation is accurate, and is particularly useful as the latter is usually the only performance metric available on real data. In contrast, for all the ICA methods repeatability is essentially independent of accuracy; the ICA algorithms show reliable convergence to relatively inaccurate solutions. Though it is an obvious point, it is one that is perhaps worth repeating: test\u2013retest reliability is only a necessary, rather than sufficient, condition for successful inference. \n\nThe Supplementary material contains the equivalent set of results when the algorithms are asked to infer a different number of modes to the set in the ground truth. What is striking is how consistent the relative accuracy of the methods is. This suggests that when there is a mismatch in dimensionality, as is likely the case on real data, the results can still be trusted. Similarly, if we look at the recovery of the BOLD subspace we can see that the PFMs recover this much more consistently as dimensionality varies. For the methods that rely on PCA to find the subspace, as dimensionality increases more variance is explained. The issue is that if this extra variance represents noise the accuracy will actually reduce. However, for the PFMs there is an explicit prior on haemodynamic time courses which seems to suppress the amount of noise introduced into the subspace by the extra components. \n\nIn summary, the results from our simulations lead us to believe that the PFMs our method infers have interesting and valid spatial and temporal interactions. Furthermore, we believe that, for our method, test\u2013retest reliability will be a useful indicator of accuracy on real rfMRI data. \n\n\n\n### HCP data \n  \nFor the subsequent analyses we use rfMRI acquired as part of the HCP\u2014full details of the various acquisitions can be found in publications from the project ( ). \n\nEach subject has four 15-minute rfMRI runs, acquired using multi-band acceleration with a TR of 0.72\u00a0s to give 1200 time points per run. The runs are sampled into the standard set of just over 90,000 grayordinates and then FIX cleaned ( ) to automatically remove as many structured artefacts as possible. These cleaned runs are then aligned using MSM ( ), a flexible framework for surface-based registration based on information from multiple modalities. In this case, registration is driven by both structural and functional features. Cortical folding patterns and myelin maps were used as the structural features. The functional features were subject-specific low dimensional sICA components, extracted by running ICA on the group followed by dual regression. \n\nWe used all 209 of the subject data sets publicly available at the time these analyses were run. \n\nNote that the set of grayordinates includes both cortical and subcortical structures, and all algorithms were run on the full set of vertices. However, the following figures only show the results on the cortical surfaces. \n\n#### Test\u2013retest reliability \n  \nIn order to evaluate how stable our algorithm is on real data we ran two analyses, both looking to extract 30 PFMs from the full set of available HCP data. The convergence of the PFM maps, from different random initialisations, is shown in  . The PFM numbers we assign here are used consistently in all subsequent sections. The maps themselves can be found in the Supplementary material. \n\nThe choice of 30 PFMs was somewhat arbitrary, though it did seem to give sets of modes that related, to a reasonable extent, to some spatial maps reported in the literature. If the dimensionality was increased, to the region of 100 PFMs, we observed that a set of PFMs with a similarly large spatial extent was inferred, often closely matching to the results presented here. The remaining PFMs were either eliminated from the model or seemed to capture subject-specific artefacts. This is an area that clearly warrants further investigation and we would hope to be able to reliably identify larger numbers of modes with more data sets and more iterations of the analysis. \n\nAs   shows, the algorithm clearly converges to a stable set of PFMs, though the Bayesian model regularisation automatically eliminates some of the thirty from the model. Twelve PFMs are inferred with a correlation coefficient of above 0.9, with a further five scoring above 0.8. \n\nHowever, there are examples of plausible PFMs that are only present in one of the analyses. For example, PFMs 10 and 12 have low reliabilities despite having very plausible spatial distributions. By way of contrast, PFMs 26 to 30 are neither strongly reproduced nor consistent with previously reported results. This is exactly as we would expect given our simulated data results, where we observed that low reproducibility does not necessarily imply low accuracy. It is highly unlikely that a random initialisation will lead to the most stable decomposition, as several similar Bayesian methods have noted ( ), but it is important to show that the algorithm can converge from disparate start points in parameter space, as demonstrated here. \n\n\n#### Interactions between \u2018cognitive\u2019 modes \n  \nTo illustrate the advantages of having a method that can flexibly infer both spatial and temporal interactions we will focus on five PFMs that relate to areas associated with higher cognitive functions. The spatial maps for these PFMs are shown in  . \n\nThese are based on one of the analyses used to illustrate test\u2013retest reliability, where we extracted 30 PFMs. The full set of extracted spatial maps is shown in the Supplementary material. \n\nThe dorsal (visual) attention system (DA,  a) is associated with top down control of externally directed attention ( ). The default mode (DM,  d) is thought to be involved in self-directed thought and background levels of attention ( ). The third well-established mode is the fronto-parietal control system (FPC), thought to flexibly couple with either the DA or DM in order to mediate between internal and external attention ( ). Our method splits this into left and right lateralised forms, which we will term the lFPC ( b) and the rFPC ( c). \n\nFinally, we have also highlighted a mode which, like the DM, is strongly present in the posteromedial cortex (PMC) and inferior parietal lobule  (PMPL,  e). This is present in three distinct regions of the PMC and these are, from anterior to posterior, the retrosplenial cortex, the posterior cingulate cortex (PCC) and the anterior bank of the parieto-occipital sulcus (V6A ( )/POS2 ( )). \n\nIt is no great surprise that it is possible to identify several different modes that contain regions within the PMC, as this is an area of cortex that has repeatedly been associated with high functional heterogeneity. For example, patterns of resting state correlations have been shown to be strongly dependent on which area of the PMC is used as the seed ( ). Similarly, PMC regions are often highlighted by network analyses ( ), for example as functional ( ), or structural \u2018hubs\u2019 ( ). Even within modes, the PMC has often been identified as a crucial nexus, with network analyses frequently suggesting that, within the DM, all roads lead to the PCC ( ). \n\nGiven the wealth of fMRI literature, it would be tempting to start assigning roles to those modes, such as the PMPL, that do not closely correspond with previously characterised functional systems. However, entertaining as it would be to speculate on the cognitive function of modes, this is not something we can do with any great confidence given that \u201ca solid first-order understanding of cortical parcellation remains elusive\u201d ( ). All the results presented here are from analyses of high resolution, surface-based data acquired at low TR\u2014without this high quality surface data it is extremely unlikely that it would be possible to disentangle these modes at all. That being the case, the exact correspondence between these results and those based upon relatively low resolution, volume-based data, used by many of the studies we have cited, is unclear. \n\nWhat we can do, however, is use these PFMs to illustrate how our method deals with modes that are both spatially and temporally correlated. The full and partial spatial correlations between the PFMs we have highlighted are shown in  a, with the equivalent temporal correlations displayed in  b. The fact that there are many non-zero spatial and temporal correlations between modes is evidence in itself that neither sICA nor tICA would be able to accurately infer this exact set of modes' spatial maps and time courses. \n\nThe temporal partial correlations between the well established PFMs are consistent with their previous characterisations. The DM strongly anti-correlates with the DA, while the lFPC and rFPC are strongly correlated with each other. Both the DA and DM are partially correlated with the two elements of the FPC, though more weakly. If we now look at the full correlations then the spatial and temporal correlations show a similar pattern of positive and negative correlations between the PFMs. \n\nHowever, if we look at the interactions of the PMPL we see that there are large, positive spatial correlations with the other four PFMs whereas there is a mixture of positive and negative temporal correlations. The partial correlations show that the PMPL, like the DM, is anti-correlated with the DA; however, it seems to only weakly interact with the DM. What is especially intriguing is that the PMPL does not symmetrically correlate with the lFPC and rFPC. Rather, it seems to weakly anti-correlate with the lFPC but strongly correlate with the rFPC. \n\nThe interesting point about this set of interactions is that the spatial correlations are not trivially predictive of the temporal correlations, and vice versa, once again suggesting our approach can identify sets of PFMs with complex spatio-temporal structure. \n\n\n#### Subject variability \n  \nOne important component of our model is the ability to explicitly model differences between subjects. In   we look at three subject-specific variants of the DA. \n\nWhile the subject variants are unsurprisingly much noisier than the group map, they are all recognisably the same PFM. What is perhaps surprising is the amount of variation in the locations of key spatial features. \n\nFor example, the spatial weights in the ventral premotor cortex (vPMC) only appear relatively weakly in the group map. If we look at the three subject variants we can see that this appears strongly in the first two subjects\u2014though in the second subject at a distinctly different position to the peak of the group activation\u2014whereas in the third subject there seem to be no strong spatial weights in that region at all. \n\nSimilarly, there is a large amount of variability in the locations of the large spatial weights that encircle visual area MT. In subject 1 the region of large weights in the posterior temporal lobe (pTL)  is completely spatially separated from the other areas, whereas in subject 3 there is a large swathe of strong weights included in the mode linking this region to the rest of the strongly weighted regions within the parietal lobe. \n\nTo try to quantify these observations, we carried out an ROI analysis on the subject variants of the DA. The variability across subjects of the spatial activations in the three ROIs shown in   is plotted in  . We chose ROIs in the left hemisphere, comprising the region of high activity in the pTL, the weak activity at the group level in the vPMC and a control region, not involved in the DA, situated in the motor cortex (MC). \n\nThe ROI in the MC shows a close to zero mean correlation, with a degree of variability which we expect represents a baseline\u2014simply reflecting the relatively small number of grayordinates and the inherently noisy estimates of the individual subject maps. Both the pTL and vPMC show non-zero mean correlations, as expected. However, the pTL exhibits a much larger degree of variability than the MC, and the vPMC is more variable again. \n\nWe hypothesise that the high variability, relative to the control, in these regions is mainly attributable to the spatial mismatch between subjects. In other words, in the well aligned subjects the ROIs appear very similar, whereas when the alignment is less accurate the activity within the ROIs barely overlaps at all, leading to very dissimilar ROIs between some subjects. Given this variability, it seems highly unlikely that the region in the vPMC, for example, could be identified reliably without recourse to its strong connectivity to the rest of the DA. This raises several questions about how subject variability influences the appropriate dimensionality of functional parcellations\u2014a point we will return to in the discussion. \n\nFinally, given that the MSM registration is already informed by functional features, these spatial shifts are somewhat surprising. One possibility is that there is simply a fundamental difference between the measures of similarity we are examining and the metric implied by the particular choice of functional features for registration. To clarify the impact of the functional information on the registration, we re-ran our algorithm on two different random subsets of 50 subjects: one where MSM had been informed by sulcal depth, myelination and subject-specific low dimensional sICA components (MSM ) and the other where MSM had been driven by sulcal depth alone (MSM ). We then compared how similar the inferred subject maps were under each of the registration schemes. The results are plotted in  . \n\nWhat is striking is the large shift in the positive mode of the distribution. When subjects are registered with functional information, their subject-specific maps look much more alike, exactly as expected. However, the high variability between subjects, even with the improvements from MSM registration, remains a pressing issue. \n\n\n#### Comparison with sICA and tICA \n  \nAs well as comparing the reliability of different decompositions through test\u2013retest reliability, it is also instructive to look at where the similarities and differences lie between approaches. For example, given that the HCP represents a step change in data quality, quantity and preprocessing, it could be that any new results from our decomposition relate to the data, rather than the method. \n\nTo this end, we ran 30 dimensional sICA and tICA on the HCP data and looked at the spatial similarities between the ICA modes and those inferred by our method in the previous section. The results are plotted in   and the ICA maps are shown in the Supplementary material alongside the PFMs they are paired with here. The Supplementary material also contains a similar plot, illustrating the similarity between the sICA and tICA spatial maps. \n\nMost of the PFMs have a fairly close correspondence with a mode identified by one of the ICA methods but crucially neither sICA nor tICA can account for all PFMs; this suggests that our method is identifying a genuinely different decomposition to either ICA approach. That is not to say that we would expect different algorithms to infer wholly unrelated sets of modes. Given that they are all run on the same data and are built on matrix factorisation models, it is natural to expect a fairly large degree of similarity between decompositions\u2014indeed, the opposite would be a major cause for concern in light of the wealth of literature characterising resting state modes. \n\n\n\n\n## Discussion \n  \nIn this paper, we have introduced a new method for identifying modes from rfMRI. It can disentangle sets of modes with complex spatio-temporal interactions, as well as inferring information about the nature of variations across subjects. Our results suggest that our method is at least as robust as current popular methods, despite fitting a more complex model to the data. Furthermore, the non-trivial temporal correlation structures we identify, in agreement with existing results from both the task and resting state literature, give us confidence that we can identify modes with the kind of dynamics that will be amenable to non-stationary functional connectivity network analyses. \n\n### Nodes: modes or parcels? \n  \nOur model is explicitly based around the concept of modes, in that we deliberately place few hard restrictions on the spatial structure of the components we infer. This naturally leads to identification of components that, due to their large spatial extent and prominent anti-correlations, often superficially resemble previous results from tICA analyses. These PFMs are clearly interesting in their own right; however, given the recent interest in non-stationary functional network analyses, high-dimensional parcellations, based around spatially compact and positively correlated regions, have come to the fore. \n\nUltimately, the choice of whether to analyse modes or parcels depends on, to varying extents, the research question, data properties and personal preferences. Here, we briefly discuss the implications of our results for this choice. \n\n#### Network analyses \n  \nFrom a network analysis perspective, both parcels and modes are fundamentally looking for the same thing\u2014ways to simplify the representation of voxelwise rfMRI connectivity with as little information loss as possible. This naturally leads to the definition of regions as groups of voxels that share a common time course, a concept which can be formalised mathematically as a matrix factorisation approach (Eq.\u00a0 ). \n\nWhile there is a common mathematical grounding, parcels have come to the fore for several reasons. Firstly, network analyses of parcel time courses are arguably more interpretable; the interactions between distinct brain regions are a conceptually simpler construct than those between gross cortical ensembles that potentially overlap and contain anti-correlations. Secondly, if we could identify a high dimensional parcellation reliably, then mode structures should naturally fall out of any subsequent network analysis\u2014the concern is that the spatial scale of modes leads to loss of useful information. Indeed, the characterisation of temporal functional modes using tICA was explicitly based around this notion: a high dimensional set of parcels was identified before these were combined into a temporally independent set of modes. Note that this is the stICA approach we investigate in our simulations. \n\nIt is not unreasonable to assume that the higher the dimensionality of the parcellation the richer the description of the data. However, the crux of the matter is that the parcellation has to be both meaningful and reliable. Therefore, in light of subject variability and noisy data, it is imperative that the suitability of any parcellation comes under rigorous scrutiny; if this is improperly defined all subsequent network analyses will be rendered meaningless. \n\n\n#### Implications of subject variability \n  \nThe results we have presented from our modelling of subject variability lead us to believe that spatial mismatches are one of the biggest, if not the biggest, sources of currently observable differences between subjects. These mismatches presumably reflect some combination of misalignments, either arising from cases where the registration is not able to make functional regions perfectly coincident, or, alternatively, cases where registration could not possibly work as the areal topology is genuinely different between subjects. \n\nFor example, given the variability in spatial location of the region in the vPMC that correlates with the rest of the DA, we do not believe that a group-level parcellation at this spatial scale  would be robust enough to enforce functional correspondence across subjects. \n\nThe only reason our model can reliably find this region, despite its variable spatial location, is that it consistently correlates with the much larger spatial regions of the DA in the parietal and temporal lobes. Crucially, the mode as a whole is large enough to be robust to variations in functional localisation across subjects. However, this does not hold if the distinct regions that form the mode\u2014in other words, the parcels we would hope to uncover from a higher dimensional analysis\u2014are considered separately from each other. \n\nAgain, this is a particular surprise given we are already using functional registration\u2014in this case using MSM, though several methods have been proposed ( )\u2014and as we show in   it is working well. Our model for subject variability is not explicitly designed to capture spatial shifts, though the fact that it can correct for them to some extent is particularly encouraging. Our view is that the relationship between models like ours and functional registration algorithms should be a symbiotic one, where better characterisation of functional data can be used to increase the accuracy of the registrations, and improved registration allows functional information to be spatially localised with increasing specificity. \n\n\n#### Spatial templates \n  \nIn their discussion of the work of  , which used connectivity rather than spatial information to predict functional responses, Jbabdi and Behrens noted that \u201c[b]y mapping onto a purely spatial template, we lose a great deal of detail that is present in individual responses, and we are left to interpret only the spatial peaks that are consistent across subjects\u201d ( ). Hopefully, what we have shown here is that provided spatially consistent peaks do exist, it is then possible to recover some of the information about individual responses. An interpretation of the way our model for subject variability is able to infer this information is that it, very na\u00efvely, uses the strong connectivities between the different regions that form a PFM to correct for spatial variability. \n\nHowever, while our model should ameliorate these problems to some extent, this is by no means addressing the pivotal issues head-on. That a voxel or region should be intrinsically defined by its connections seems an eminently sensible approach; how this transition from a spatial to a connectivity-based template is achieved in practice is an extensive area for future research. \n\nFinally, we believe that it is this need for spatially consistent peaks to exist that severely restricts the minimum spatial extents of modes. Our finding from the test\u2013retest reliability scores, that around 20 PFMs are reliably identified, does seem to agree with previous results. For example, in their analysis, Yeo et al. examined the stability of non-overlapping parcels identified with a clustering approach ( ). They found that there were peaks in the stability of the clustering when 7, 10, 12 or 17 parcels were identified\u2014a result that is perhaps challenging to reconcile with the current tendency to use high-dimensional parcellations. The improvements in alignment offered by MSM and our relaxation of some of the spatial assumptions they made, especially allowing overlap, leads us to believe that our method would naturally find more PFMs. However, we only find a few more PFMs; our interpretation of both these findings is that modes have to cover a surprisingly large spatial area in order to be robust to subject variability. \n\n\n\n### Computational considerations \n  \nCrucially, our algorithm operates on the full voxelwise data. Having to work in a reduced dimensionality subspace, for example a small set of PCA components, is a fundamental limit for several algorithms\u2014including the ICA approaches we have tested here. While post-hoc techniques, like dual regression, can go some way towards alleviating this, there seem to be advantages to working with the full data. \n\nHowever, for projects like the HCP with very large cohorts, simultaneously working with hundreds of runs in this way poses a not insignificant computational challenge. For example, simply loading the data from the 209 subjects we have analysed in this paper requires nearly 700\u00a0GB of memory. Similarly, our algorithm took almost a week to run on this data, typically utilising twelve cores of the machine. By way of comparison, the incremental group PCA, used as a first step for the ICA approaches, still takes several days to run on the same data, albeit with much smaller memory requirements ( ). \n\nThese types of computational issues will only become more pressing as these large projects become the norm\u2014the HCP alone will ultimately contain six times as many subjects as analysed here. In a sense, the approach to these computational issues is the fundamental difference between our approach and MSDL. Our spatial prior still allows for subject modelling, but by choosing not to impose a spatial smoothness constraint the computational complexity of our algorithm is reduced, thereby allowing the analysis of hundreds of subjects simultaneously. As discussed earlier, similar simplifications were made for the HRF modelling too. We are not trying to claim that ours is the optimal solution, as the MSDL cost functions clearly have their own advantages. However, the trade-off between model complexity and data throughput is likely to come under increasing scrutiny as the amount of available data swells. \n\n\n### Bayesian modelling \n  \nOne of the major driving forces behind some of our choices when developing our probabilistic model was ensuring that the model remained amenable to Bayesian inference; for example, the variational approximation introduces deviations from the \u2018true\u2019 posterior, but is extremely computationally efficient. Given these trade-offs, it would be reasonable to ask whether the benefits of a fully Bayesian model really do outweigh the costs, especially as in the results presented here we have tended to focus on very simple summary statistics of our posterior distribution\u2014often simply the posterior mean of the parameters in question. \n\nWe firmly believe that full Bayesian modelling is a useful approach, for several reasons. Firstly, by not only learning parameters, but also their associated uncertainty, the overall inference improves. \n\nSecondly, the posterior distribution is an enormously rich description of the data. While this is challenging to visualise, we expect that this will contain genuinely interesting information. Furthermore, this is information that could be incorporated into any subsequent network analysis. \n\nFinally, and perhaps most importantly, the Bayesian approach gives a principled framework in which to build and compare models. We have made several distinct modelling choices\u2014looking for modes rather than parcels or considering a canonical linear HRF, for example. However, these are choices; it would be straightforward to alter the model to reflect a different set of assumptions. What we have demonstrated here is that it is possible to build ambitious models, tailored to fMRI data, that are computationally feasible even for huge numbers of subjects. \n\n\n\n## Algorithm \n  \nWe refer to our approach/software as PROFUMO (PRObabilistic FUnctional MOdes). Our hope is that a future version of PROFUMO can be made publicly available as part of FSL. \n\n \n", "metadata": {"pmcid": 4349633, "text_md5": "c36f2420b8e1f27461cb9ddffbe0f90b", "field_positions": {"authors": [0, 156], "journal": [157, 167], "publication_year": [169, 173], "title": [184, 250], "keywords": [264, 350], "abstract": [363, 2071], "body": [2080, 61669]}, "batch": 1, "pmid": 25598050, "doi": "10.1016/j.neuroimage.2015.01.013", "pmc_url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4349633", "efetch_url": "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pmc&id=4349633"}, "display_title": "pmcid: <a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4349633\">4349633</a>", "list_title": "PMC4349633  Large-scale Probabilistic Functional Modes from resting state fMRI"}
